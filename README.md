# 네트워크

## 컴퓨터 네트워크

**두 대 이상의 컴퓨터가 연결되어 있는 것**을 컴퓨터 네트워크라고 하고, 컴퓨터 간에 필요한 데이터를 서로 주고받을 수 있습니다.

전 세계의 크고 작은 네트워크를 연결하는 거대한 네트워크를 **인터넷** 이라고 합니다.

#### 패킷(packet)

컴퓨터 간에 데이터를 주고받을 때 **네트워크를 통해 전송되는 데이터의 작은 조각**을 패킷이라고 합니다.

큰 데이터를 그대로 보내면 네트워크의 대역폭을 많이 차지(점유)하기 때문에 패킷을 사용합니다.

#### 디지털 데이터(digital data)

컴퓨터는 이진수(0과 1)을 사용하며 그 0과 1의 집합을 디지털 데이터라고 합니다.

**비트는 0과 1의 정보를 나타내는 최소 단위**입니다.

**바이트는 8비트를 나타내는 단위**이며 컴퓨터는 주로 바이트 단위로 데이터를 읽고 씁니다.

문자를 디지털 데이터로 변환하기 위해서는 문자 코드를 사용하며 해당 문자에 대응하는 숫자로 변환시킵니다. (ex : ASCII 코드...)

#### LAN(Local Area Network), WAN(Wide Area Network)

**LAN(랜)은 건물 안이나 특정 지역을 범위로 하는 네트워크**입니다. 연결하는 거리가 짧기 때문에 **속도가 빠르고 오류 발생 확률이 적습니다.**

**WAN(왠)은 ISP(인터넷 서비스 제공자)가 제공하는 서비스를 사용하여 구축된 네트워크**입니다. 랜과 랜을 연결하는 것이며 거리가 멀기 때문에 랜에 비해 **속도가 느리고 오류 발생 확률이 높습니다.**

ISP : 인터넷 상용 서비스 사업을 하는 사업자 (KT, U+, SK브로드밴드와 같은 통신 회사들)

#### 가정에서의 네트워크

가정에서 네트워크를 사용하기 위해서는 

1. ISP의 인터넷을 WAN을 통해 인터넷 공유기에 전달합니다.
2. 인터넷 공유기(무선 랜 공유기)를 중심으로 내부 인터넷망(사설망)을 구성합니다.
3. LAN 케이블을 이용한 유선 랜과 케이블이 필요 없는 무선 랜으로 다양한 기기를 연결합니다.

#### 소규모 회사의 네트워크

회사의 네트워크 구성은 가정에서의 네트워크와 다른데 간단히 말하자면 **DMZ라는 외부에 공개하는 네트워크가 있다는 점**입니다.

회사에서는 웹 서버, 메일 서버 등 외부 사용자에게 공개하기 위한 네트워크가 있으며 이를 DMZ라고 합니다.

회사에서는 서버를 사내 혹은 데이터 센터에 두거나(온프레미스) 클라우드에 두고 운영합니다.

## 프로토콜

**컴퓨터 간의 원활한 통신을 위해 지키기로한 규약을 프로토콜**이라고 합니다.

#### OSI 모델 & TCP/IP 모델

**OSI 모델은 ISO(국제표준화기구)에서 정한 네트워크의 기본이 되는 모델**입니다.

**물리 계층, 데이터 링크 계층, 네트워크 계층, 전송 계층, 세션 계층, 표현 계층, 응용 계층**의 일곱 개의 계층으로 구성됩니다.

송신할 때에는 응용 계층부터 물리 계층까지 수신할 때에는 물리 계층부터 응용 계층까지의 순서대로 데이터를 전달합니다.

**TCP/IP 모델은 4계층으로 이루어진 네트워크 모델**입니다.

**네트워크 접속 계층, 인터넷 계층, 전송 계층, 응용 계층** 네 개의 계층으로 구성됩니다.

OSI 모델의 물리 계층, 데이터 링크 계층이 TCP/IP 모델의 네트워크 접속 계층으로, 네트워크 계층이 인터넷 계층으로, 세션, 표현, 응용 계층이 응용 계층으로 이루어져 있습니다.

#### 캡슐화와 역캡슐화

**데이터를 전송할 때 전송에 필요한 정보를 붙여서 보내는데 이 정보를 헤더**라고 합니다. (헤더에는 수신 측의 정보도 포함되어 있습니다.)

**헤더를 붙이는 과정을 캡슐화, 제거하는 과정을 역캡슐화**라고 합니다.

**데이터를 전송할 때, OSI 7계층에서 각 계층에 해당하는 헤더를 붙이며(캡슐화) 데이터 링크층에서는 데이터의 마지막에 추가하는 정보인 트레일러를 붙입니다.**

이렇게 만들어진 데이터는 전기신호로 바뀌어 수신 측에 도착하고 **수신 측에서는 해당 계층의 헤더를 제거(역캡슐화)하며 상위 계층으로 전달**합니다.

## 물리 계층

**물리 계층은 컴퓨터와 네트워크 장비를 연결하고 전기 신호로 변환하는 계층**입니다.

데이터를 통신할 때에는

1. 비트열 데이터를 전기 신호로 변환
2. 네트워크를 통해 수신 측에 도착
3. 수신 측에서 전기 신호를 비트열 데이터로 복원

의 과정을 거칩니다.

**비트열 데이터는 컴퓨터의 랜카드를 통해 전기신호로 변환**됩니다.

#### 트위스티드 페어 케이블(렌 케이블)

전송 매체(데이터가 흐르는 물질적인 선로)에는 유선과 무선으로 나뉘어집니다.

유선에는 트위스트 페어 케이블, 광 케이블 등이 있고, 무선에는 라디오파, 마이크로파, 적외선 등이 있습니다.

**트위스티드 페어 케이블은 일반적으로 랜 케이블이라고 부르며 UTP(Unshield Twisted Pair) 케이블과 STP(Shield Twisted Pare) 케이블**이 있습니다. **렌 케이블 양쪽 끝에는 RJ-45라고 부르는 커넥터가 붙어있으며 이 커넥터를 사용해 네트워크 기기에 연결**할 수 있습니다.

**STP 케이블은 두 개씩 꼬아 만든 선을 실드(금속 호일이나 금속의 매듭같은 것으로 노이즈를 막는 역할을 함)로 보호한 케이블**입니다. **노이즈(케이블에 전기 신호가 흐를 때 발생하는 것이며 전기 신호의 형태가 왜곡됨)의 영향을 매우 적게** 받지만 비싸서 보편적이지는 않습니다.

**UTP 케이블은 두 개씩 꼬아 만든 네 쌍의 전선**으로 **실드로 보호 받지 않는 케이블**입니다. **노이즈의 영향을 받기 쉽지만 저렴**하기에 보편적으로 사용됩니다.

렌 케이블에는 다이렉트 케이블과 크로스 케이블이 있습니다. 두 케이블 모두 1, 2, 3, 6번 구리선을 사용하지만 연결 방식에 따른 차이가 있습니다. 

**다이렉트 케이블은 구리 선 여덟 개를 같은 순서로 연결한 케이블로 컴퓨터와 스위치를 연결할 때 사용**합니다.

**크로스 케이블은 구리 선 여덟 개 중 한쪽 커넥터의 1,2번에 연결되는 구리 선을 다른 쪽의 3번 6번에 연결한 케이블이며 컴퓨터 간에 직접 연결할 때 사용**합니다.

#### 리피터와 허브

리피터와 허브는 물리 계층에서 동작하는 네트워크 장비입니다.

**리피터는 전기 신호를 정형하고 증폭하는 기능**을 합니다. 멀리 있는 상대와 통신할 수 있도록 파형을 정상으로 만들어 주는 역할을 하지만 요즘에는 다른 네트워크 장비가 리피터 기능을 지원하기에 따로 사용할 필요는 없습니다.

**허브는 리피터와 마찬가지로 전기 신호를 정형하고 증폭하는 기능을 하며 포트가 여러 개 있어서 컴퓨터 여러 대를 서로 연결하는 장치**로써 쓰입니다. 

**특정 포트로부터 데이터를 받으면 연결된 모든 포트에게 전송하기 때문에 더미 허브**라고 불리기도 합니다.

## 데이터 링크 계층

**데이터 링크 계층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층**입니다.

랜에서 데이터를 정상적으로 주고받기 위해 필요한 계층이며 그 규칙들 중 일반적으로 많이 사용되는 규칙이 **이더넷(Ethernet)** 입니다.

#### 이더넷

이더넷은 허브와 같은 장비에 연결된 컴퓨터와 데이터를 주고 받을 때 사용합니다.

허브는 모든 포트에 데이터를 전송하기 때문에 이를 방지하기 위해 보내려는 데이터에 목적지 정보를 추가하여 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하게 합니다.

여러 컴퓨터가 데이터를 전송해도 충돌이 일어나지 않도록 하기 위해서 데이터를 보내는 시점을 늦추는 **CSMA/CD** 방법을 사용합니다.

CSMA/CD 방법이란

CS : 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 확인한다

MA : 신호가 흐르지 않는다면 데이터를 보내도 좋다

CD : 충돌이 발생하고 있는지 확인한다.

의 과정을 거칩니다. 하지만 효율이 좋지 않아 CSMA/CD는 거의 사용되지 않습니다.

#### MAC 주소

**랜 카드에는 MAC 주소라는 번호**가 정해져 있습니다. 제조할 때 새겨지기 때문에 **물리 주소**라고도 부르며 **전 세계에서 유일한 번호**로 할당되어 있습니다.

48비트의 숫자로 구성되어 있으며 앞의 24비트는 제조사 번호, 뒤 24비트는 일련번호입니다.

데이터 링크 계층에서 이더넷 헤더와 트레일러를 붙이는데, **이더넷 헤더는 목적지 MAC 주소(6바이트)+출발지 MAC 주소(6바이트)+유형(2바이트)** 로 구성되어 있습니다.

이더넷 유형은 이더넷으로 전송되는 상위 계층 프로토콜의 종류를 의미합니다.

**트레일러는 FCS(Frame Check Sequence)라고도 하는데 오류 발생 여부를 확인하는 역할**을 합니다.

**이더넷 헤더와 트레일러가 추가된 데이터를 프레임**이라고 합니다.

#### 스위치

**스위치는 데이터 링크 계층에서 동작**하며 **레이어 2 스위치** 또는 **스위칭 허브**라고 불립니다.

스위치 내부에는 스위치의 포트 번호와 해당 포트에 연결된 컴퓨터의 MAC 주소가 등록 되어 있는 **MAC 주소 테이블**이라는 것이 있습니다.

컴퓨터에 **프레임이 전송되면 MAC 주소 테이블을 확인하고 등록되어 있지 않으면 MAC 주소를 포트와 함께 등록**합니다. 이를 **MAC 주소 학습 기능**이라고 합니다.

스위치는 허브와 다르게 **목적지 MAC 주소가 MAC 주소 테이블에 있다면 해당 포트에만 필터링을 전송(MAC 주소 필터링)** 합니다.

**하지만 목적지 MAC 주소가 MAC 주소 테이블에 등록되어 있지 않으면 연결되어 있는 모든 포트에 프레임이 전송**되는데 이 현상을 **플러딩(flooding,홍수**)이라고 부릅니다.

#### 전이중 통신과 반이중 통신

**데이터의 송수신을 동시에 하는 통신 방식을 전이중 통신 방식**이라고 합니다. 데이터를 동시에 전송해도 충돌이 발생하지 않습니다.

**회선 하나로 송신과 수신을 번갈아가면서 하는 통신 방식을 반이중 통신 방식**이라고 합니다. **데이터를 동시에 전송하면 충돌이 발생**합니다.

허브는 송수신이 나누어져 있지 않아 반이중 통신을 사용해야 하지만, 스위치는 충돌이 일어나지 않는 구조로 되어 있어 전이중 통신 방식이 가능합니다.

#### 충돌 도메인

**충돌이 발생할 때 그 범위를 충돌 도메인**이라고 합니다.

허브의 충돌 도메인은 연결되어있는 컴퓨터 전체이며 스위치는 그에 비해 범위가 좁습니다.

#### 이더넷 규격

이더넷은 케이블 종류나 속도에 따라 다양한 규격으로 분류됩니다

10BASE-T를 예시로 들어 10은 통신 속도(Mbps), BASE는 BASEBAND라는 전송 방식, T는 케이블의 종류(UTP)를 의미합니다.

## 네트워크 계층

데이터 링크 계층의 이더넷 규칙으로는 같은 네트워크로 데이터를 전송할 수는 있으나 다른 네트워크로는 데이터를 전송할 수 없습니다.

**네트워크 계층은 다른 네트워크 간의 통신을 가능하게** 해줍니다.

다른 네트워크로 데이터를 전송하기 위해서는 **라우터(router)** 가 필요한데, **라우터는 데이터의 목적지까지 어떤 경로로 가는 것이 좋은지 알려주는 기능**을 합니다.

라우터는 **IP 주소를 통해 목적지가 어떤 네트워크의 어떤 컴퓨터인지 구분**하게 됩니다.

**라우터가 데이터를 어떤 경로로 보낼지 결정하는 것을 라우팅(routing)** 이라고 합니다.

**라우터는 라우팅 테이블을 통해 경로 정보를 등록하고 관리**합니다.

#### IP

**네트워크 계층에서는 캡슐화를 할 때 IP 헤더를 붙입니다.**

IP 헤더에는 버전,헤더 길이, 서비스 유형, 전체 패킷 길이, ID, 조각 상태, 조각의 위치, TTL, 프로토콜, 헤더 체크섬, 출발 IP 주소, 목적지 IP 주소의 순서로 구성되어 있습니다.

**IP 헤더가 추가된 데이터를 IP 패킷**이라고 합니다.

**IP 주소는 ISP(인터넷 서비스 제공자)에게** 받을 수 있습니다.

IP 버전에는 **IPv4, IPv6**가 있습니다.

**IPv4는 32비트로 약 43억개의 주소**를 만들 수 있는데 인터넷이 보급됨에 따라 IP 주소가 부족해져서 IP 주소를 **340간 개를 만들 수 있는 128비트인 IPv6**와 함께 사용하고 있습니다.

IP 주소에는 **공인 IP와 사설 IP**가 있습니다. **ISP가 제공하는 IP 주소는 공인 IP**입니다.

**인터넷에 직접 연결되는 컴퓨터나 라우터에 공인 IP 주소를 할당하고, 회사나 가정의 랜에 있는 컴퓨터는 사설 IP를 할당하고 있습니다.**

**공인 IP 주소를 라우터에만 할당**하고 **랜 안에 있는 컴퓨터에는 랜의 네트워크 관리자가 사설 IP 주소를 할당**하거나, **라우터의 DHCP 기능**을 사용하여 주소를 자동으로 할당합니다.

DHCP(Dynamic Host Configuration Protocol) : IP 주소를 자동으로 할당하는 프로토콜

**IP 주소는 32비트의 2진수를 사용**하지만 읽기 쉽도록 **8비트씩(옥텟) 10진수로 변환하여 표시**합니다.

> **11000000|10101000|00000001|00001010 ▶︎192.168.1.10**

**IP 주소는 네트워크 ID와 호스트 ID로 구성**됩니다. **네트워크 ID는 어떤 네트워크인지**, **호스트 ID는 어떤 컴퓨터인지** 나타내는 주소입니다.

IPv4의 IP 주소는 32비트이나 **네트워크 ID를 크게 만들거나 호스트 ID를 작게 만들어 네트워크의 크기를 조정**할 수 있습니다. **네트워크의 크기는 클래스**로 구분합니다.

| 클래스 이름 |         내용          |
| :---------: | :-------------------: |
|  A 클래스   | 대규모 네트워크 주소  |
|  B 클래스   |  중형 네트워크 주소   |
|  C 클래스   | 소규모 네트워크 주소  |
|  D 클래스   |    멀티캐스트 주소    |
|  E 클래스   | 연구 및 특수용도 주소 |

일반 네트워크에서는 A~C 클래스를 사용할 수 있습니다.

**A 클래스는 처음 8비트가 네트워크 ID, 다음 24비트가 호스트 ID**입니다.

**B 클래스는 처음 16비트가 네트워크 ID, 다음 16비트가 호스트 ID**입니다.

**C 클래스는 처음 24비트가 네트워크 ID, 다음 8비트가 호스트 ID**입니다.

| 클래스 이름 |                    공인 IP 주소의 범위                     |     사설 IP 주소의 범위     |
| :---------: | :--------------------------------------------------------: | :-------------------------: |
|  A 클래스   |    1.0.0.0~9.255.255.255<br />11.0.0.0~126.255.255.255     |   10.0.0.0~10.255.255.255   |
|  B 클래스   |  128.0.0.0~172.15.255.255<br />172.32.0.0~191.255.255.255  |  172.16.0.0~172.31.255.255  |
|  C 클래스   | 192.0.0.0~192.167.255.255<br />192.169.9.9~233.255.255.255 | 192.168.0.0~192.168.255.255 |

IP 주소에는 **네트워크 주소**와 **브로드캐스트 주소**가 있습니다. 두 주소는 컴퓨터나 라우터가 사용할 수 없는 주소입니다.

**네트워크 주소는 호스트 ID가 0(00000000)인 주소**이며, **브로드캐스트 주소는 호스트 ID가 255(11111111)** 인 주소입니다.

**네트워크 주소는 전체 네트워크에서 작은 네트워크를 식별하는 데 사용**됩니다. (네트워크의 대표 주소)

**브로드캐스트 주소는 네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송하는 데 사용**되는 주소입니다. 브로드캐스트 주소로 데이터를 전송하면 네트워크 안에 있는 모든 컴퓨터가 데이터를 받게 됩니다.

#### 서브넷

**서브넷(subnet)은 분할된 네트워크**를 말하고 분할하는 행위를 서브넷팅(subneting)이라고 합니다.

**서브네팅을 하면 호스트 ID 일부를 빌려 서브넷 ID로 바꾸고 IP 주소는 네트워크 ID, 서브넷 ID, 호스트 ID**로 나누어지게 됩니다.

**서브넷 마스크는 네트워크 ID와 호스트 ID를 식별하기 위한 값**입니다.

네트워크 ID와 서브넷 ID의 비트수를 말하며 프리픽스 표기법(/비트 수)으로 표기할 수 있습니다.

#### 라우터

**라우터는 네트워크를 분리할 수 있게 하는 장비**입니다.

허브와 스위치는 모든 컴퓨터와 동일한 네트워크에 속하지만 라우터는 네트워크를 분할할 수 있게 해줍니다.

**분리된 네트워크에서 다른 네트워크에 데이터를 전송하려면 라우터의 IP 주소를 설정해야합니다. 이는 네트워크의 출입구를 설정하는 것이며 기본 게이트웨이(default gateway)라고 합니다.**

라우팅은 경로 정보를 기반으로 다른 네트워크로 최적의 경로를 통해 데이터를 전송합니다. 이 **경로 정보는 라우팅 테이블에 등록**되어 있습니다.

라우팅 테이블은 수동 혹은 자동으로 등록할 수 있습니다.

**라우터 간에 라우팅 정보를 교환하기 위한 프로토콜을 라우팅 프로토콜이라고 합니다.**

## 전송 계층

**전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요**합니다.

전송 계층은 **오류를 점검하는 역할과 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 역할**을 합니다.

#### 연결형 통신과 비연결형 통신

**연결형 통신은 상대편과 확인해 가면서 통신하는 방식**입니다. 연결형 통신은 **신뢰할 수 있고 정확한** 데이터를 전달합니다. (ex : TCP)

**비연결형 통신은 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식**입니다. 비연결형 통신은 **효율적**으로 데이터를 전달합니다. (ex : UDP)

#### TCP

TCP는 신뢰성과 정확성을 우선으로 하는 **연결형 통신 프로토콜**입니다.

**TCP로 전송할 때 붙이는 헤더를 TCP 헤더**라고 하며, **TCP 헤더가 붙은 데이터를 세그먼트**라고 합니다.

TCP 헤더는 출발지 포트 번호, 목적지 포트번호, 일련번호, 확인 응답 번호, 헤더 길이, 예약 영역, 코드 비트, 윈도우 크기, 체크섬, 긴급 포인터, 옵션으로 이루어져 있습니다.

**TCP 헤더의 코드비트 부분은 6비트로 이루어져 있으며연결의 제어 정보가 기록되는 곳**입니다. 

이 중 **SYN(연결 요청), ACK(확인 응답)을 통해 연결 확립을 합니다.**

신뢰할 수 있는 연결을 하려면 데이터를 전송하기 전, 세 번 패킷을 교환하는데

1. A에서 연결 확립 요청 SYN을 보냄
2. B에서 연결 확립 응답 ACK와 연결 확립 요청 SYN을 보냄
3. A에서 연결 확립 응답 ACK을 보냄

의 과정으로 패킷을 교환합니다. 이 과정을 **3-way 핸드셰이크**라고 합니다.

연결을 끊을 때에는

1. A에서 연결 종료 요청 FIN을 보냄
2. B에서 연결 종료 응답 ACK와 연결 종료 요청 FIN을 보냄
3. A에서 연결 종료 응답 ACK를 보냄

의 과정으로 이루어집니다.

#### 일련번호와 확인 응답 번호

TCP는 데이터를 분할해서 전송합니다. 이 때 **일련번호는 송신 측에서 이 데이터가 몇 번째 데이터인지 알려주는 역할**을 합니다.

**확인 응답 번호는 수신 측에서 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할(확인응답)** 을 합니다.

일련번호와 확인 응답 번호를 사용해서 **데이터가 손상되거나 유실된 경우에 데이터를 재전송하는데 이를 재전송 제어**라고 합니다.

#### 윈도우 크기

세그먼트를 한 번 보낼 때마다 한 번 응답을 반환하는 방식은 효율이 낮기에, 세그먼트를 연속해서 보내고 난 다음 확인 응답을 받는 방식을 사용합니다.

**받은 세그먼트는 버퍼에 저장**됩니다.

수신 측에게 **대량으로 데이터가 전송되면 보관하지 못하고 넘쳐버리는데 이것을 오버플로**라고 합니다.

오버플로가 발생하지 않도록 버퍼의 한계를 알아야 하는데 이는 TCP 헤더의 **윈도우 크기 값에** 해당합니다. 윈도우 크기의 초깃값은 3-way 핸드셰이크를 할 때 판단합니다.

#### 포트

**TCP 헤더의 출발지, 목적지 포트번호를 통해 애플리케이션을 구분할 수 있습니다.**

**포트 번호는 0~65535번**을 사용할 수 있으며 **1~1023번 포트는 잘 알려진 포트(well-known ports)**, 1024번은 예약되어 있지만 사용되지 않는 포트이고, **1025번 이상은 클라이언트 측의 송신포트(랜덤 포트)** 로 사용됩니다.

#### UDP

UDP는 데이터를 효율적으로 빠르게 보내는 **비연결형 프로토콜**입니다. 

UDP 헤더가 붙은 데이터를 UDP 데이터그램이라고 합니다.

UDP 헤더는 출발지 포트 번호, 목적지 포트 번호, 길이, 체크섬으로 구성되어 있습니다.

UDP를 사용하면 랜에있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있습니다. 이것을 **브로드캐스트**라고 합니다.



---

모두의 네트워크(저자: 미즈구치 카츠야)를 읽고 정리한 내용입니다.

